@using SFA.DAS.EAS.Domain
@using SFA.DAS.EAS.Domain.Extensions
@using SFA.DAS.EAS.Domain.Models.EmployerAgreement
@using SFA.DAS.EAS.Web;

@model OrchestratorResponse<SFA.DAS.EAS.Web.ViewModels.EmployerAgreementListViewModel>
@{
    ViewBag.PageID = "organisations-agreements-home"; 
    ViewBag.Title = "Organisations";
    ViewBag.Section = "organisations";

    if (TempData.ContainsKey("extraCompanyAdded"))
    {
        ViewBag.PageID = "page-organisations-added";
        TempData.Remove("extraCompanyAdded");
    }
}

<div class="grid-row header-index">
    <div class="column-two-thirds">
        <h1 class="heading-xlarge">Your organisations and agreements</h1>
    </div>
    <div class="column-one-third">
        <form action="@Url.Action("AddOrganisation", "Organisation")" method="GET">
            <input class="button action-add" id="addNewPaye" type="submit" value="Add new organisation">
        </form>
    </div>
</div>
<div class="grid-row">
    <div class="column-two-thirds">
        <p>Add each organisation that will make an agreement with a training provider for apprenticeship training.</p>
        <p>There is no restriction on the number of <a href="https://www.gov.uk/government/publications/employment-allowance-more-detailed-guidance" target="_blank" rel="external">connected organisations</a> you can add.</p>
        
        <table>
            <thead>
            <tr>
                <th scope="col">Organisation</th>
                <th scope="col">Agreement</th>           
                <th scope="col">Spending Status</th>
                <th scope="col"></th>
            </thead>
            <tbody>

                @foreach (var employerAgreement in Model.Data.EmployerAgreements)
                {
                    <tr>
                        <td>@employerAgreement.LegalEntityName</td>

                        <td>@employerAgreement.SignedByName
                        @if (employerAgreement.SignedDate.HasValue)
                        {
                            @:Signed Date: @employerAgreement.SignedDate.Value.ToString("dd/M/yyyy")
                        }
                        </td>
                        <td>
                            @(employerAgreement.Status == EmployerAgreementStatus.Signed ? "Spending Enabled" : "Spending Disabled")
                        </td>
                        <td>
                            <a href="@Url.Action("Details", "EmployerAgreement",new {agreementid=employerAgreement.HashedAgreementId})">View</a>
                            <a href="@Url.Action("AboutYourAgreement", "EmployerAgreement",new {agreementid=employerAgreement.HashedAgreementId})">Sign agreement</a>
                        </td>
                    </tr>
                }
            </tbody>
        </table>

        

    </div>
</div>
@section breadcrumb {
    <div class="breadcrumbs">
        <ol role="navigation">
            <li><a href="@Url.Action("Index", "EmployerTeam", new {HashedAccountId = @Model.Data.HashedAccountId})">Home</a></li>
            <li>Your organisations and agreements</li>
        </ol>
    </div>
}
